# PlayerHoods｜关系与组织系统蓝图（综合冻结版）

> 本文档用于**一次性汇总并冻结**本轮讨论中涉及的所有核心决策，作为 PlayerHoods（playerhoods.com）在「人群 / 关系 / 组织 / 社交边界」方面的**权威蓝图版本**。  
> 目标是：**尊重现实网球组织方式，避免社交网络化，同时保证长期可扩展性与系统稳定性。**

---

## 一、总体设计心法（最高原则）

**PlayerHoods 不是一个社交网络，而是一个“把线下关系转化为可组织行动”的系统。**

核心心法：

> - 关系必须显式建立（邀请 + 接受）  
> - 人群边界必须清晰、可解释、可治理  
> - 系统不裁判人，只承载选择  
> - 发起权可分散，边界权必须集中  
> - 社交只服务于“把一场球打成”，不追求关系最大化

---

## 二、核心对象定义

### 1. Group（长期人群边界）

**定义**：
- Group 是长期存在的人群边界
- 用于决定：
  - 谁能被邀请
  - 谁能报名
  - 谁在同一组织语境中

**Group 不是什么**：
- 不是聊天群
- 不是好友列表
- 不是社交网络

**规模与治理分水岭**：
- ≤4 人：不适合 Group（见 Direct Group）
- ≥5 人：必须是 Group，且必须有 Organizer

---

### 2. Direct Group（2–4 人直约边界）

**定义**：
- 成员数：2–4 人
- 典型场景：单打、固定双打、小型高重复约球

**关键特征**：
- 不设 Organizer（无治理需求）
- 成员完全对等
- 仅保留技术 Owner（用于归档、链接兜底）
- 不涉及准入、筛选或治理

**核心用途**：
> 解决“我以后还能不能方便地再约你”

**重要规则**：
- Direct Group ≠ 私聊
- 不提供群聊
- 沟通仅通过：Offer 附言 + Match 留言（TTL）

---

### 3. Match（一次性事件）

**定义**：
- 一场具体的球局/活动
- 必须绑定一个“临时冻结的 Match Boundary”

**关键原则**：
- Match 使用人群，但不改变任何人群结构
- Match 结束后不反向生成长期关系

---

## 三、角色与权限模型

### 1. Organizer（Boundary Keeper，仅存在于 Group）

**Organizer 的本质**：
> 人群边界的守门人，而不是管理员或裁判

**核心权限**：
- 创建 / 定义 Group
- 决定 Group 的：
  - 可见性
  - 准入策略
  - 成员移除
- 负责长期边界质量

**明确没有的权限**：
- 不给成员评分
- 不做公开评价
- 不裁决“好/坏球友”

---

### 2. Member（Group 内成员）

**基本原则**：
> Member 可以“使用边界做事”，但不能“改变边界本身”。

**Member 可以**：
- 发起 Match
- 邀请 Group 内成员参加 Match
- 邀请其他 Group / Direct Group 的人参加 Match
- 生成 Open Link（若该 Group 允许）

**Member 不可以**：
- 擅自改变 Group 成员结构
- 决定 Group 可见性

---

## 四、Set 类型分界规则（冻结）

> **当一个人群需要决定“谁不能上场”时，就必须有 Organizer。**

**冻结规则**：
- 2–4 人 → Direct Group（无 Organizer）
- ≥5 人 → Group（必须有 Organizer）

---

## 五、Group 可见性（Visibility）

Group 在创建时必须设定可见性：

1. **Private（默认）**
   - 仅成员可见

2. **Discoverable**
   - 符合条件的用户可发现
   - 需申请加入

3. **Hidden (Link-accessible)**
   - 不公开展示
   - 仅通过链接/邀请码访问

> 可见性只影响“是否能看到”，不等于“是否能加入”。

---

## 六、Join Policy（准入策略，可配置）

Group 创建时可设定：

1. **Organizer Approval（默认）**
   - 新人需 Organizer 确认

2. **Auto-Join via Link/Code**
   - 通过链接自动加入
   - 链接可撤销、可限次

3. **Member-Invite Auto-Join（高信任）**
   - 成员邀请即加入
   - 建议仅少数群使用

---

## 七、Match 发起与治理规则

### 1. 发起权
- Group 内任何 Member 可发起 Match
- Organizer **不需要**查看或确认

### 2. 兜底原则
- Organizer 不介入日常流程
- 但系统保留“紧急兜底取消权”（极端情况）

### 3. Match 留言（TTL）

**规则（冻结）**：
- Match 留言允许球后延时
- 必须有 TTL（默认 24 小时）
- 到期后自动只读

**原则**：
> Match 可以承载互动余温，但不可承载长期关系。

---

## 八、Offer vs Signup（两种报名机制）

### Offer（邀请制，默认）
- Organizer / Member 点人
- Accept = 确认
- 无二次确认

### Signup（报名制，例外）
- 用户报名 ≠ 确认
- Organizer 需筛选

---

## 九、信任与风险管理（不做评价系统）

**明确不做**：
- 评分
- 星级
- 公开 endorsement

**系统支持的真实做法**：
- 被反复邀请 = 隐性信任
- Organizer 私有笔记（仅自己可见）
- 静默不再邀请（系统不提示、不标记）

---

## 十、赛后建立 Direct Group（关键能力）

**规则（冻结）**：
- 两名共同参与过 Match 的用户
- 可手动发起建立 1:1 Direct Group
- 必须双方确认
- 系统不自动、不推荐

---

## 十一、俱乐部（Club）作为一等信息

### 1. 设计原则
- 网球是线下关系，强依赖俱乐部可达性
- 俱乐部 ≠ 身份认证（v1 不做认证）

### 2. 数据模型
- 用户可绑定多个俱乐部（Club Affiliations）
- 每条包含：
  - active/inactive
  - primary/secondary
  - season（summer/winter/all_year）
  - visibility（private/public_to_discovery）

### 3. 使用方式
- 默认基于主俱乐部进行发现
- Match 可选择“本场所属俱乐部”作为上下文

---

## 十二、整体结构一句话总结

> **PlayerHoods 的关系设计不是为了“连接尽可能多的人”，  
> 而是为了“在每一次行为中冻结一个清晰、可解释、可治理的边界”。**

---

（本版本为综合冻结版，可作为后续实现、UI、数据库设计的权威依据）

---

## 十三、内容分享与可见性模型（Group 作为可见性边界）

### 1. 核心判断（冻结）

> **Group 不仅是“约球边界”，也是 playerhoods.com 的核心“可见性 / 访问控制边界”。**

在本系统中，内容分享不采用“好友 / 关注”模型，而采用：
- Group = access list / audience set

这与前述关系设计完全一致：Group 不是社交关系本身，而是一个天然的 **invite / access list**。

---

### 2. Group 在内容系统中承担的角色

Group 可以同时承担以下三种职责：

- **可见性边界**：谁能看到某条内容
- **分发集合**：内容发布时，系统向哪些人分发
- **未来权限基础**：点赞 / 评论 / 下载等能力，均基于同一集合判断

> 这使 Group 成为内容系统与约球系统的统一基础结构。

---

### 3. 内容分享的权限模型（统一 Visibility 设计）

对每一条内容（装备、训练、照片、笔记等），统一使用以下 visibility 模型：

- **private**：仅自己可见（默认）
- **invite_sets**：选择一个或多个 Group（最常用）
- **public（预留）**：完全公开（仅在未来需要时启用）

UI 表达为一句自然语言问题：
> “谁可以看到？” → 选择 Group

---

### 4. 两种常见内容形态

#### 形态 1：一次性内容（Post / Share）

例如：
- “这双鞋很好用”
- “新拍线参数”
- “这一段训练视频”

规则：
- 创建时选择 Group（一个或多个）
- 发布后可编辑可见性（增加 / 移除 Group）

---

#### 形态 2：长期资料（Profile-like）

例如：
- 我的装备库
- 我的常用配置
- 我的训练日志

建议做成 **模块级可见性**：
- 装备库：对哪些 Group 可见
- 训练日志：对哪些 Group 可见

避免每条内容单独选择，降低维护成本。

---

### 5. 内容可见性的治理规则（非常关键）

#### 5.1 成员变动的影响（快照式权限）

采用 **发布时受众快照（audience snapshot）** 模型，逻辑等同于微信朋友圈：

- 发布时：
  - 你选择 Group(s)
  - 系统将当时这些 Group 的成员展开为一份“受众快照”
- 之后：
  - Group 成员的增加 / 减少
  - **不影响**这条内容的可见性

结果：
- 新加入的人：默认看不到历史内容
- 被移除的人：默认仍可看到当时已可见的内容

> 这是最符合直觉、也最安全的默认策略。

---

#### 5.2 高级撤销（可选能力）

作为高级能力（非默认）：
- 作者可对某 Group / 某成员撤销历史可见性

但该能力：
- 不默认开启
- 不等同于朋友圈能力
- 仅作为高级控制手段存在

---

### 6. 同一内容分享给多个 Group

系统不复制内容本体，而是：
- 一条内容
- 多个 Group 作为分发选择
- 权限按“受众集合”统一管理

当撤销其中一个 Group 的分享时：
- 仅移除该集合对应的受众
- 不影响其他 Group

---

### 7. 默认安全策略（当前阶段冻结）

为保证早期安全与心智清晰，playerhoods.com 的默认策略为：

- 默认可见性：**private**
- 创建内容时：
  - 显式选择 Group（可多选）
- 提供快捷选择：
  - 最近使用的 Group
- **不提供**：
  - “对我所在的所有 Group 可见” 作为默认选项

> 防止可见性边界被无意放大。

---

### 8. 数据模型建议（实现层，冻结方向）

采用“内容 + 受众快照”模型：

- **content_items**
  - id
  - author_id
  - type
  - payload
  - created_at

- **content_audience_users**（权限核心）
  - content_id
  - viewer_id
  - created_at
  - UNIQUE(content_id, viewer_id)

发布流程：
1. 作者选择 Group(s)
2. 系统展开当时成员列表
3. 批量写入 content_audience_users
4. 后续查询仅基于该表判断权限

可选补充表：
- content_audience_invite_sets（仅用于 UI 展示当时选了哪些集合）

---

### 9. RLS 语义（与 Supabase 非常契合）

- 作者：始终可读自己的内容
- 读权限：
  - 仅当 content_audience_users 中存在 (content_id, auth.uid())

优点：
- 无需实时计算 Group 成员
- 权限稳定、可预测
- 与“成员变动不影响历史内容”的原则完全一致

---

### 10. 与约球 Group 的统一性

- 内容分享：
  - Group = “我发给谁看”
- 约球：
  - Group = “我邀请谁来”

> **同一个心智模型，贯穿行为与内容。**

---

### 11. 一句话总结（可作为该模块的蓝图注释）

> Group 是 playerhoods.com 中统一的可见性与访问控制边界。  
> 内容发布时冻结受众，关系变化不反向影响历史内容，  
> 这在隐私、解释性与系统稳定性上都是最优解。

